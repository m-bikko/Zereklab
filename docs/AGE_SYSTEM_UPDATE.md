# Обновление системы возрастных категорий

## Обзор изменений

Система возрастных категорий была обновлена с диапазонов (6-8 лет) на минимальный возраст (3+, 4+, ..., 20+).

## Что изменилось

### Старая система
- Диапазоны: "6-8 лет", "9-12 лет", "13+ лет"
- Фильтр по возрастным диапазонам
- Жесткая категоризация

### Новая система
- Минимальный возраст: "3+", "6+", "9+", и т.д.
- Фильтр по возрасту ребенка (1-20 лет)
- Гибкая система подбора товаров

## Компоненты

### 1. Утилиты (`lib/ageUtils.ts`)
- `getAgeOptions()` - опции возраста от 1 до 20 лет
- `formatAgeForDisplay()` - форматирование для отображения
- `isProductSuitableForAge()` - проверка подходящего возраста
- `convertToMinimumAge()` - конвертация старого формата

### 2. Админ-панель
- Dropdown с выбором минимального возраста от 1 до 20 лет
- Валидация формата возраста
- Подсказки для пользователя

### 3. Фильтры продуктов
- Вопрос "Сколько лет вашему ребенку?"
- Dropdown с выбором от 1 до 20 лет
- Показывает товары, подходящие для выбранного возраста

### 4. API (`app/api/products/route.ts`)
- Поддержка нового формата фильтрации
- Клиентская фильтрация по минимальному возрасту
- Обратная совместимость со старыми данными

## Миграция данных

Запустите команду для конвертации существующих данных:

```bash
npm run migrate-age-format
```

### Примеры конвертации:
- "6-8" → "6+"
- "9-12" → "9+"
- "13+" → "13+" (без изменений)

## Логика фильтрации

### Как это работает:
1. Пользователь выбирает возраст ребенка (например, 7 лет)
2. Система показывает товары с минимальным возрастом ≤ 7
3. Товары "3+", "6+", "7+" будут показаны
4. Товары "8+", "10+" не будут показаны

### Примеры:
- Ребенок 5 лет → показываем товары "1+", "3+", "5+"
- Ребенок 10 лет → показываем товары "1+" до "10+"
- Ребенок 15 лет → показываем товары "1+" до "15+"

## Обратная совместимость

Система поддерживает старые форматы возрастов в базе данных:
- Функции с `@deprecated` тегами
- API поддерживает оба формата
- Автоматическая конвертация при отображении

## Преимущества новой системы

1. **Точность** - товар подходит для конкретного возраста ребенка
2. **Гибкость** - легко добавлять новые возрастные категории
3. **UX** - понятный вопрос про возраст ребенка
4. **Масштабируемость** - поддержка возрастов от 1 до 20 лет

## Тестирование

1. Админ-панель: `/admin` - создание/редактирование товаров
2. Фильтры: `/products` - фильтрация по возрасту
3. API: `GET /api/products?ageRange=5` - возраст 5 лет

## Примеры использования

### В компонентах:
```typescript
import { formatAgeForDisplay, isProductSuitableForAge } from '@/lib/ageUtils';

// Отображение возраста
const displayAge = formatAgeForDisplay(product.ageRange); // "6+ лет"

// Проверка подходящего возраста
const suitable = isProductSuitableForAge(product.ageRange, 7); // true для "6+"
```

### В API:
```bash
# Товары для ребенка 8 лет
curl "http://localhost:3000/api/products?ageRange=8"

# Показывает товары с минимальным возрастом от 1+ до 8+
``` 